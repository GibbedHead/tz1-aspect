# Логирование времени исполнения методов с помощью Spring AOP

Выполнено как задание в открытой школе T1:
> Разработать систему учета времени выполнения методов в приложении с использованием Spring AOP. Система должна быть способна асинхронно логировать и анализировать данные о времени выполнения методов.


## Запуск

* Клонировать проект
* Скомпилировать
* Запустить docker контейнеры с сервисом логирования
* Запустить файл, работа методов которого логируется


```bash
git clone https://github.com/GibbedHead/tz1-aspect.git
cd .\tz1-aspect\
mvn package
docker compose up -d
//wait for containers to start
java -jar .\weather-service\target\weather-service-0.0.1-SNAPSHOT.jar
```


## Описание

Проект написан для Java 17 и использует Postgresql 16

* ### weather-service
Приложение, время выполнения методов которого логируется
* ### metrics
Spring Boot приложение, реализующее API для сохранения логов *weather-service* и получения статистики по классам и методам.
В файле *api-docs.yaml* содержится *OpenApi* спецификация реализованного API.

## Реализация задания
> Создайте аннотации @TrackTime и @TrackAsyncTime, которые можно применять к методам для отслеживания времени их выполнения.
Реализуйте аспекты, используя Spring AOP, для асинхронного и синхронного отслеживания времени выполнения методов, помеченных соответствующими аннотациями.
Создайте сервис, который будет асинхронно сохранять данные о времени выполнения методов в базе данных.
Реализуйте REST API для получения статистики по времени выполнения методов (например, среднее время выполнения, общее время выполнения) для различных методов и их групп.
Настройте приложение с помощью конфигурации Spring для включения использования AOP и асинхронной обработки данных.

Для решения задачи созданы:
* Аннотации @TrackTime и @TrackAsyncTime. Первой помечаются синхронно работающие методы, второй - асинхронно.
* Spring AOP аспекты TrackTimeAspect и TrackAsyncTimeAspect, которые срабатывают для методов, помеченных соответствующими аннотациями.
* MetricsClient, асинхронно отправляющий данные о работе метода с помощью WebClient.
* API статистики

## Как используются аспекты и аннотации
Для проверки работы указанных выше функций написано приложение, которое собирает данные о температуре в заданном городе из публичных API visualcrossing.com и weatherapi.com.

Для обеих API написаны синхронный и асинхронный метод получения температуры и общие методы, которые получают погоду для двух городов используя синхронные методы и асинхронные.

Все соответствующие методы помечены нужными аннотациями.
```
@TrackTime
getCityTemperature

@TrackAsyncTime
asyncGetCityTemperature

@TrackTime
printForCity
  getCityTemperature
  getCityTemperature

@TrackAsyncTime
asyncPrintForCity
  asyncGetCityTemperature
  asyncGetCityTemperature
```

Такая структура сделана, чтобы в статистике видеть что время выполнения *printForCity* равно суммарным временам *getCityTemperature*, а для асинхронного *asyncPrintForCity* время выполнения в среднем равно самому большому времени выполнения одного из *asyncGetCityTemperature*